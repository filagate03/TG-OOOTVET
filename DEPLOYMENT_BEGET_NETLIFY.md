# Полная инструкция по деплою: Beget (Backend) + Netlify (Frontend)

Эта инструкция поможет вам развернуть бэкенд на хостинге Beget (используя бесплатный технический домен) и связать его с фронтендом на Netlify.

---

## 1. Подготовка Бэкенда (Beget)

### Шаг 1: Загрузка файлов
1. Зайдите в файловый менеджер Beget.
2. Перейдите в папку вашего технического домена (обычно это `/home/u/user/username.beget.tech/public_html`).
3. Загрузите туда **все файлы и папки** из текущего проекта, **КРОМЕ** папки `frontend` и папки `.venv`.
4. Убедитесь, что в корне проекта на сервере есть папка `media`. Если нет — создайте её.

### Шаг 2: Настройка через SSH (Самый важный этап)
Подключитесь к серверу через терминал (используйте PowerShell, CMD или терминал VS Code):
```bash
ssh username@username.beget.tech
```
*(Замените `username` на ваш логин Beget. Пароль такой же, как от панели управления).*

После успешного входа введите следующие команды по очереди:

1. **Перейдите в папку проекта:**
   ```bash
   cd ~/username.beget.tech/public_html
   ```

2. **Создайте и активируйте виртуальное окружение:**
   ```bash
   python3 -m venv .venv
   source .venv/bin/activate
   ```

3. **Обновите pip и установите зависимости:**
   ```bash
   pip install --upgrade pip
   pip install -r requirements.txt
   ```

4. **Инициализируйте базу данных:**
   ```bash
   python init_db.py
   ```

5. **Создайте файл настроек окружения:**
   ```bash
   nano .env
   ```
   Вставьте туда следующий текст (замените URL на ваш будущий адрес Netlify):
   ```env
   ENVIRONMENT=production
   FRONTEND_URL=https://your-project-name.netlify.app
   ```
   *(Нажмите `Ctrl+O`, затем `Enter` для сохранения, и `Ctrl+X` для выхода).*

### Шаг 3: Настройка Python-приложения в панели Beget
1. Перейдите в панель управления Beget -> раздел **"Сайты"** -> **"Python"**.
2. Нажмите **"Добавить приложение"**:
   - **Домен**: Выберите ваш технический домен (`username.beget.tech`).
   - **Корень приложения**: укажите путь к папке (например, `username.beget.tech/public_html`).
   - **Файл приложения**: `run.py`.
   - **Объект приложения**: `app`.
   - **Версия Python**: 3.11 или выше.
3. Нажмите "Добавить". Приложение запустится автоматически.

---

## 2. Подготовка Фронтенда (Netlify)

### Шаг 1: Настройка связи с Бэкендом
1. В локальном проекте откройте папку `frontend`.
2. Создайте в ней файл `.env.production` (если его нет).
3. Впишите туда адрес вашего бэкенда на Beget:
   ```env
   VITE_API_URL=https://username.beget.tech
   ```

### Шаг 2: Сборка проекта
В терминале на вашем компьютере (в папке `frontend`) выполните:
```bash
npm install
npm run build
```
После этого появится папка `dist`.

### Шаг 3: Деплой
1. Зайдите на [Netlify](https://app.netlify.com/).
2. Перетащите папку `frontend/dist` в окно загрузки "Deploy manually".
3. После загрузки вы получите URL (например, `https://super-cool-site.netlify.app`).

---

## 3. Финальная проверка

1. Скопируйте полученный URL от Netlify.
2. Вернитесь в SSH на Beget или в файловый менеджер.
3. Отредактируйте файл `.env` на сервере, чтобы `FRONTEND_URL` совпадал с вашим адресом Netlify.
4. В панели Beget (раздел Python) нажмите **"Перезапустить приложение"**.

Теперь ваш фронтенд на Netlify будет корректно общаться с бэкендом на Beget!

## 2. Подготовка Фронтенда (Netlify)

### Шаг 1: Настройка URL API
В папке `frontend` создайте или отредактируйте файл `.env.production`. В качестве URL укажите ваш технический домен Beget:
```env
VITE_API_URL=https://username.beget.tech
```

### Шаг 2: Сборка и Деплой
1. В папке `frontend` выполните:
   ```bash
   npm install
   npm run build
   ```
2. Загрузите содержимое папки `frontend/dist` в Netlify (через Drag-and-Drop или привяжите GitHub репозиторий).

### Шаг 3: Настройка Redirects (уже добавлено)
Файл `frontend/public/_redirects` позволяет React Router работать корректно при обновлении страницы.

## 3. Связка (CORS)

Чтобы фронтенд на Netlify мог делать запросы к бэкенду на Beget:
1. В файле `backend/core/config.py` уже настроены разрешенные домены.
2. Убедитесь, что в `.env` на Beget переменная `FRONTEND_URL` точно совпадает с адресом вашего сайта на Netlify.

## 4. Запуск Ботов

Бэкенд автоматически запускает ботов, токены которых добавлены в базу данных через панель управления. Убедитесь, что сервер Beget имеет доступ к серверам Telegram.